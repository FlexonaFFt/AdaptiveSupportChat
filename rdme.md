# AdaptiveSupport — текущий статус

## Что уже реализовано
- Асинхронный Telegram-бот на `aiogram`.
- Запуск через `FastAPI + uvicorn` (единый API-процесс).
- Два режима работы бота:
  - `BOT_MODE=polling` (для локальной разработки),
  - `BOT_MODE=webhook` (для прод-сценариев).
- Базовый API-эндпоинт `GET /health`.
- Поддержка сценариев из markdown-файла (`FLOW_FILE`, по умолчанию `docs/flow.md`).

## Reader (v1)
- Реализован `reader`, который:
  - читает `flow.md`,
  - парсит блоки (`message`, `menu`, `mes-menu`),
  - валидирует структуру и переходы,
  - строит runtime-граф для бота.
- Ошибки спецификации возвращаются в структурированном виде (`E_*` коды).

## Flow Engine (v1)
- Хранит текущее состояние пользователя (in-memory).
- Обрабатывает переходы по кнопкам.
- Рендерит сообщения и inline-кнопки по сценарию.
- Поддерживает правило `hide_on_next` (скрытие прошлого сообщения при следующем шаге).

## Безопасность и конфигурация
- Креды бота не хранятся в репозитории.
- Используются переменные окружения (`.env`, есть `.env.example`).
- Основные параметры:
  - `BOT_TOKEN`
  - `BOT_MODE`
  - `FLOW_FILE`
  - `APP_HOST`, `APP_PORT`
  - `WEBHOOK_BASE_URL`, `WEBHOOK_PATH` (для webhook-режима)

## Что достигнуто
- Получен рабочий MVP адаптивного бота, который строит диалог и кнопки из внешнего markdown-сценария.
- Подготовлена база для следующего этапа: горячая перезагрузка flow, персистентное хранилище состояния и расширенные правила маршрутизации.
